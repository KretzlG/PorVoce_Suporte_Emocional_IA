<!DOCTYPE html>
<html lang="pt-br">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="static/img/logo.png">
        <title>Cadastro</title>
        <link rel="stylesheet" href="static/css/auth/login_register.css">
        <link rel="stylesheet" href="static/css/auth/error_styles.css">
        <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    </head>

    <body>
        <div>
            <img src="static/img/fundo.png" alt="fundo" class="background">
        </div>
            
        <div class="container">
            <h1 style="color: #666 !important; display: block !important; font-size: 32px !important; margin: 20px 0 30px 0 !important; text-align: center !important;">
                <span style="color: #999 !important; margin-right: 10px !important; font-size: 32px !important;">></span> 
                Cadastre-se
            </h1>
            
            <form method="post" class="register-form">
                <div class="input-container">
                    <input type="text" name="first_name" placeholder="Digite seu nome" required>
                </div>

                <div class="input-container">
                    <input type="email" name="email" placeholder="Digite seu e-mail" required>
                </div>

                <div class="input-container">
                    <input type="tel" name="phone" placeholder="Digite seu telefone">
                </div>

                <div class="input-container">
                    <input type="password" name="password" placeholder="Digite sua senha" id="senha1" required>
                    <i class="bi bi-eye-fill" id="btn-senha1" onclick="mostrarSenha('senha1', 'btn-senha1')"></i>
                </div>

                <div class="input-container">
                    <input type="password" name="confirm_password" placeholder="Confirme sua senha" id="senha2" required>
                    <i class="bi bi-eye-fill" id="btn-senha2" onclick="mostrarSenha('senha2', 'btn-senha2')"></i>
                </div>

                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="paciente" name="user_type" value="client" required>
                        <label for="paciente">Sou paciente</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="profissional" name="user_type" value="volunteer" required>
                        <label for="profissional">Sou profissional</label>
                    </div>
                </div>

                <div class="checkbox-container">
                    <input type="checkbox" id="terms" name="terms" required>
                    <label for="terms" class="terms-label">
                        Eu li e aceito os termos e condições de serviço
                    </label>
                </div>

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="error-messages">
                            {% for category, message in messages %}
                                {% if category == 'success' %}
                                    <p class="success-message" style="display: block;">{{ message }}</p>
                                {% else %}
                                    <p class="error-message" style="display: block;">{{ message }}</p>
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                <button class="button" type="submit">Criar conta</button>

                <p class="login-link">Já tem uma conta? <a href="{{ url_for('auth.login') }}">Faça login</a></p>
            </form>
        </div>

        <script src="static/js/auth/show_password.js"></script>
        <script src="static/js/notifications.js"></script>

        <!-- Máscaras e validações de segurança -->
        <script>
        // Máscara para telefone (formato brasileiro)
        document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
            let x = e.target.value.replace(/\D/g, '').slice(0, 11);
            if (x.length > 10) {
                e.target.value = x.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (x.length > 5) {
                e.target.value = x.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
            } else if (x.length > 2) {
                e.target.value = x.replace(/(\d{2})(\d{0,5})/, '($1) $2');
            } else {
                e.target.value = x;
            }
        });

        // Validação de nome: só letras e espaços
        document.querySelector('input[name="first_name"]').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^A-Za-zÀ-ÿ\s]/g, '');
        });

        // Validação ao enviar o formulário
        document.querySelector('.register-form').addEventListener('submit', function(e) {
            // Nome: só letras e espaços
            const nome = document.querySelector('input[name="first_name"]').value;
            if (!/^([A-Za-zÀ-ÿ]+\s?)+$/.test(nome)) {
                alert('O nome deve conter apenas letras e espaços.');
                e.preventDefault();
                return;
            }

            // E-mail: formato válido
            const email = document.querySelector('input[name="email"]').value;
            if (!/^\S+@\S+\.\S+$/.test(email)) {
                alert('Digite um e-mail válido.');
                e.preventDefault();
                return;
            }

            // Telefone: formato brasileiro
            const phone = document.querySelector('input[name="phone"]').value;
            if (phone && !/^\(\d{2}\) \d{4,5}-\d{4}$/.test(phone)) {
                alert('Digite um telefone válido no formato (99) 99999-9999.');
                e.preventDefault();
                return;
            }

            // Senha: mínimo 8 caracteres, pelo menos uma letra, um número e um símbolo
            const senha = document.querySelector('input[name="password"]').value;
            if (!/^(?=.*[A-Za-z])(?=.*\d)(?=.*[^A-Za-z\d]).{8,}$/.test(senha)) {
                alert('A senha deve ter pelo menos 8 caracteres, incluindo letra, número e símbolo.');
                e.preventDefault();
                return;
            }

            // Confirmar senha: igual à senha
            const confirmar = document.querySelector('input[name="confirm_password"]').value;
            if (senha !== confirmar) {
                alert('As senhas não coincidem.');
                e.preventDefault();
                return;
            }
        });
        </script>
    </body>

</html>